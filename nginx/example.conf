# Example Nginx configuration with x402 payment protection
#
# This configuration demonstrates how to use the x402 module to protect
# resources with HTTP micropayments.
#
# IMPORTANT: This is a conceptual configuration showing the desired Nginx
# directives. To use these directives, you need to implement an Nginx C module
# that calls the x402 FFI functions.
#
# Prerequisites:
# 1. Build the x402 FFI library: cargo build --release --features nginx
# 2. Implement an Nginx C module that uses the FFI functions
# 3. Load the module in nginx.conf
# 4. Configure x402 directives as shown below

http {
    # Load Nginx C module (requires implementing the C module)
    # load_module modules/ngx_http_x402_module.so;

    # Upstream backend server
    upstream backend {
        server 127.0.0.1:8080;
    }

    server {
        listen 80;
        server_name example.com;

        # Protected location with x402 payment
        location /api/protected {
            # Enable x402 payment protection
            x402 on;
            
            # Payment configuration
            x402_amount 0.0001;  # 0.0001 USDC
            x402_pay_to 0x209693Bc6afc0C5328bA36FaF03C514EF312287C;
            x402_facilitator_url https://x402.org/facilitator;
            x402_testnet on;  # Use testnet
            x402_description "API access payment";
            
            # Proxy to backend after payment verification
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Public location (no payment required)
        location / {
            root /var/www/html;
            index index.html;
        }

        # Health check endpoint (no payment)
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }
    }

    # Example with different payment amounts per location
    server {
        listen 8080;
        server_name api.example.com;

        # Premium API - higher payment amount
        location /api/premium {
            x402 on;
            x402_amount 0.01;
            x402_pay_to 0x209693Bc6afc0C5328bA36FaF03C514EF312287C;
            x402_facilitator_url https://x402.org/facilitator;
            x402_testnet off;
            x402_description "Premium API access";
            
            proxy_pass http://backend;
            proxy_set_header Host $host;
        }

        # Standard API - lower payment amount
        location /api/standard {
            x402 on;
            x402_amount 0.0001;
            x402_pay_to 0x209693Bc6afc0C5328bA36FaF03C514EF312287C;
            x402_facilitator_url https://x402.org/facilitator;
            x402_testnet on;
            x402_description "Standard API access";
            
            proxy_pass http://backend;
            proxy_set_header Host $host;
        }
    }
}

